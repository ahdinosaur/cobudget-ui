Url = require('url')
Path = require('path')
Promise = require('bluebird')
nets = Promise.promisify(require('nets'))
_ = require('lodash')

config = require('config')

class RestClient

  constructor: (collection) ->
    @apiUrl = config.apiUrl
    @collUrl = collection

  url: (path) ->
    url = Url.parse(@apiUrl)
    url.pathname = Path.join(
      url.pathname,
      @collUrl,
      path or ""
    )
    Url.format(url)

  action: (options) ->
    nets({
      url: @url(options.path)
      method: options.method
      json: true
    })

  get: (path) ->
    @action({
      path: path,
      method: "GET",
    })

  post: (path, body) ->
    @action({
      path: path,
      method: "POST",
    })

  put: (path, body) ->
    @action({
      path: path,
      method: "PUT",
    })

  delete: (path) ->
    @action({
      path: path,
      method: "DELETE",
    })

module.exports = RestClient
