debug = require('debug')("cobudget-ui:nav:store")
Fluxxor = require('fluxxor')

module.exports = Fluxxor.createStore
  
  actions:
    "update": "onUpdate"

  initialize: (options) ->
    
    @path = options.path

    if options.LocationBar
      @LocationBar = options.LocationBar
    else if process.browser
      @LocationBar = require('location-bar')

    if @LocationBar
      @locationBar = new @LocationBar
    else
      @locationBar = null

    @locationBar and @locationBar.onChange(((path) ->
      debug("onChange", path)

      @path = path

      @emit("change")

    ).bind(this))

    @locationBar and @locationBar.start pushState: true

  onUpdate: (path) ->

    @locationBar and @locationBar.update path, trigger: true
