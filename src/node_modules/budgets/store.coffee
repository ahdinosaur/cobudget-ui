debug = require('debug')("cobudget-ui:budgets:store")
Fluxxor = require('fluxxor')

module.exports = Fluxxor.createStore

  actions:
    getAll: "getAll"

  initialize: (options) ->

    # setup client
    @Client = options.Client or require('rest-client')
    @client = new @Client("budgets")

    # setup initial state
    @loading = true
    @budgets = []
    @error = null

    # load budgets
    @getAll()

  getAll: ->
    self = @
    @client.get()
    .spread((resp, body) ->
      debug("response", resp, "body", body)
      self.loading = false
      self.budgets = body.budgets
      self.error = null
      self.emit("change")
    )
    .caught((err) ->
      self.error = err.msg
      self.emit("change")
    )
