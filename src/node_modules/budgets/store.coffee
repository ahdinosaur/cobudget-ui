debug = require('debug')("cobudget-ui:budgets:store")
Fluxxor = require('fluxxor')

module.exports = Fluxxor.createStore
  initialize: (options) ->
    @Client = options.Client or require('rest-client')
    @client = new @Client("budgets")
    @loading = true
    @budgets = []
    @error = null

  load: ->
    self = @
    @client.get()
    .spread((resp, body) ->
      debug("response", resp, "body", body)
      self.loading = false
      self.budgets = body.budgets
      self.error = null
      self.emit("change")
    )
    .caught((err) ->
      self.error = err.msg
      self.emit("change")
    )
