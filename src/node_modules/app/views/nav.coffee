# @cjsx React.DOM

debug = require('debug')("cobudget-ui:app:views:nav")
React = require('react')
_ = require('lodash')

Fluxxor = require('fluxxor')
FluxChildMixin = Fluxxor.FluxChildMixin(React)
StoreWatch = Fluxxor.StoreWatchMixin

BudgetSelect = require('budgets/views/select.coffee')

Router = require('react-router')
ActiveState = Router.ActiveState
Navigation = Router.Navigation

module.exports = React.createClass
  mixins: [
    FluxChildMixin,
    ActiveState, Navigation
  ]

  render: ->
    debug("render'ing", @state, @props)

    return (
      <nav className="row">
        <div className="col-md-12 nav bar container">
          <div className="col-md-2 brand">
            <i className="col-md-2 fa fa fa-bars fa-1x"></i>
            <p className="col-md-6">COBUDGET</p>
          </div>

          <div className="col-md-3 selector">
            <BudgetSelect
              budgets={@props.budgets}
              budgetId={(@getActiveParams or {}).budgetId}
              onChange={@onBudgetSelect}
            />
          </div>
        </div>
      </nav>
    )

  onBudgetSelect: (budgetId) ->
    debug("onBudgetSelect", budgetId)

    # if no active budgetId
    if not (@getActiveParams or {}).budgetId
      # do not add new history entry
      @replaceWith('budget', budgetId: budgetId)
    else
      @transitionTo('budget', budgetId: budgetId)
